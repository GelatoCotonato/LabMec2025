<?xml version="1.0"?>
<sdf version='1.9'>
  <!-- Basic model of the 16' WAM-V USV -->
  <model name="wamv">

    <static>false</static>

    <link name="base_footprint" />

    <link name="base_link">
      <enable_wind>true</enable_wind>
      <inertial>
        <mass>180.0</mass>
        <inertia>
          <ixx>120.0</ixx>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyy>393</iyy>
          <iyz>0.0</iyz>
          <izz>446.0</izz>
        </inertia>
      </inertial>

      <visual name="base_visual">
        <geometry>
          <mesh>
            <uri>meshes/WAM-V-Base.dae</uri>
          </mesh>
        </geometry>
      </visual>

      <!-- Top base -->
      <collision name="top_base">
        <pose>0 0 1.25 0 0 0</pose>
        <geometry>
          <box><size>1.85 1 0.1</size></box>
        </geometry>
      </collision>

      <!-- left base -->
      <collision name="left_float">
        <pose>-0.4 1.03 0.2 0 1.57 0 </pose>
        <geometry>
          <cylinder>
            <length>4</length>
            <radius>0.2</radius>
          </cylinder>
        </geometry>
      </collision>
      <collision name="left_mid_float">
        <pose>1.85 1.03 0.3 0 1.38 0</pose>
        <geometry>
          <cylinder>
            <length>0.5</length>
            <radius>0.17</radius>
          </cylinder>
        </geometry>
      </collision>
      <collision name="left_front_float">
        <pose>2.3 1.03 0.4 0 1.3 0</pose>
        <geometry>
          <cylinder>
            <length>0.45</length>
            <radius>0.12</radius>
          </cylinder>
        </geometry>
      </collision>

      <!-- right base -->
      <collision name="right_float">
        <pose>-0.4 -1.03 0.2 0 1.57 0 </pose>
        <geometry>
          <cylinder>
            <length>4</length>
            <radius>0.2</radius>
          </cylinder>
        </geometry>
      </collision>
      <collision name="right_mid_float">
        <pose>1.85 -1.03 0.3 0 1.38 0</pose>
        <geometry>
          <cylinder>
            <length>0.5</length>
            <radius>0.17</radius>
          </cylinder>
        </geometry>
      </collision>
      <collision name="right_front_float">
        <pose>2.3 -1.03 0.4 0 1.3 0</pose>
        <geometry>
          <cylinder>
            <length>0.45</length>
            <radius>0.12</radius>
          </cylinder>
        </geometry>
      </collision>
    </link>

    <joint name="base_footprint_joint" type="fixed">
      <parent>base_footprint</parent>
      <child>base_link</child>
      <pose relative_to="base_footprint">0 0 0 0 0 0</pose>
    </joint>

    <!-- left engine and thruster -->
    <link name="left_engine_link">
      <pose relative_to="left_chassis_engine_joint" />

      <inertial>
        <mass>15.0</mass>
        <inertia>
          <ixx>0.889245</ixx>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyy>0.811125</iyy>
          <iyz>0.0</iyz>
          <izz>0.078125</izz>
        </inertia>
      </inertial>

      <visual name ="left_engine_visual">
        <geometry>
          <mesh>
            <uri>meshes/engine.dae</uri>
          </mesh>
        </geometry>
      </visual>

      <collision name="left_engine_vertical_axis_collision">
        <pose>-0.145 0 -0.27 0 0 0</pose>
        <geometry>
          <box><size>0.25 0.15 0.9</size></box>
        </geometry>
      </collision>

      <collision name="left_engine_rear_end_collision">
        <pose>-0.34 0 0.12 0 0 0</pose>
        <geometry>
          <box><size>0.14 0.15 0.12</size></box>
        </geometry>
      </collision>
      
    </link>

    <joint name="left_chassis_engine_joint" type="revolute">
      <axis>
        <xyz>0 0 1</xyz>
        <limit>
          <lower>-1.57079</lower>
          <upper>1.57079</upper>
          <effort>10</effort>
          <velocity>10</velocity>
        </limit>
      </axis>
      <parent>base_link</parent>
      <child>left_engine_link</child>
      <pose relative_to="base_link">-2.373776 1.027135 0.318237 0 0 0</pose>
    </joint>

    <link name="left_propeller_link">
      <pose relative_to="left_engine_propeller_joint" />

      <inertial>
        <mass>0.5</mass>
        <inertia>
          <ixx>0.008545</ixx>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyy>0.008545</iyy>
          <iyz>0.0</iyz>
          <izz>0.0144</izz>
        </inertia>
      </inertial>

      <visual name ="left_propeller_visual">
        <geometry>
          <mesh>
            <uri>meshes/propeller.dae</uri>
          </mesh>
        </geometry>
      </visual>

      <collision name="left_propeller_collision">
        <pose>-0.08 0 0 0 1.57 0</pose>
        <geometry>
          <cylinder>
            <length>0.18</length>
            <radius>0.24</radius>
          </cylinder>
        </geometry>
      </collision>
    </link>

    <joint name="left_engine_propeller_joint" type="revolute">
      <axis>
        <xyz>1 0 0</xyz>
        <limit>
          <lower>-999999</lower>
          <upper>999999</upper>
          <effort>20</effort>
          <velocity>15</velocity>
        </limit>
        <dynamics>
          <friction>0.05</friction>
          <damping>0.05</damping>
        </dynamics>
      </axis>
      <parent>left_engine_link</parent>
      <child>left_propeller_link</child>
      <pose relative_to="left_engine_link">-0.278156 0 -0.509371 0 0 0</pose>
    </joint>

    <!-- right engine and thruster -->
    <link name="right_engine_link">
      <pose relative_to="right_chassis_engine_joint" />

      <inertial>
        <mass>15.0</mass>
        <inertia>
          <ixx>0.889245</ixx>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyy>0.811125</iyy>
          <iyz>0.0</iyz>
          <izz>0.078125</izz>
        </inertia>
      </inertial>

      <visual name ="right_engine_visual">
        <geometry>
          <mesh>
            <uri>meshes/engine.dae</uri>
          </mesh>
        </geometry>
      </visual>

      <collision name="right_engine_vertical_axis_collision">
        <pose>-0.145 0 -0.27 0 0 0</pose>
        <geometry>
          <box><size>0.25 0.15 0.9</size></box>
        </geometry>
      </collision>
      <collision name="right_engine_rear_end_collision">
        <pose>-0.34 0 0.12 0 0 0</pose>
        <geometry>
          <box><size>0.14 0.15 0.12</size></box>
        </geometry>
      </collision>
    </link>

    <joint name="right_chassis_engine_joint" type="revolute">
      <axis>
        <xyz>0 0 1</xyz>
        <limit>
          <lower>-1.57079</lower>
          <upper>1.57079</upper>
          <effort>10</effort>
          <velocity>10</velocity>
        </limit>
      </axis>
      <parent>base_link</parent>
      <child>right_engine_link</child>
      <pose relative_to="base_link">-2.373776 -1.027135 0.318237 0 0 0</pose>
    </joint>

    <link name="right_propeller_link">
      <pose relative_to="right_engine_propeller_joint" />

      <inertial>
        <mass>0.5</mass>
        <inertia>
          <ixx>0.008545</ixx>
          <ixy>0.0</ixy>
          <ixz>0.0</ixz>
          <iyy>0.008545</iyy>
          <iyz>0.0</iyz>
          <izz>0.0144</izz>
        </inertia>
      </inertial>

      <visual name ="right_propeller_visual">
        <geometry>
          <mesh>
            <uri>meshes/propeller.dae</uri>
          </mesh>
        </geometry>
      </visual>

      <collision name="right_propeller_collision">
        <pose>-0.08 0 0 0 1.57 0</pose>
        <geometry>
          <cylinder>
            <length>0.18</length>
            <radius>0.24</radius>
          </cylinder>
        </geometry>
      </collision>
    </link>

    <joint name="right_engine_propeller_joint" type="revolute">
      <axis>
        <xyz>1 0 0</xyz>
        <limit>
          <lower>-999999</lower>
          <upper>999999</upper>
          <effort>20</effort>
          <velocity>15</velocity>
        </limit>
        <dynamics>
          <friction>0.05</friction>
          <damping>0.05</damping>
        </dynamics>
      </axis>
      <parent>right_engine_link</parent>
      <child>right_propeller_link</child>
      <pose relative_to="right_engine_link">-0.278156 0 -0.509371 0 0 0</pose>
    </joint>

    <!--BATTERIES-->
    <link name="battery_dx_link">
      <pose relative_to="battery_dx_joint" />

      <inertial>
        <pose>-0.02 0 0.155 0 0 0</pose>
        <mass>23.5</mass>
        <inertia>
          <ixx>0.5015291666666667</ixx>
          <iyy>0.8931958333333333</iyy>
          <izz>1.0183333333333333</izz>
          <ixy>0</ixy>
          <ixz>0</ixz>
          <iyz>0</iyz>
        </inertia>
      </inertial>

      <visual name="battery_visual">
        <geometry>
          <mesh> 
            <uri>meshes/battery.dae</uri>
          </mesh>
        </geometry>
      </visual>
      <collision name="battery_collision">
        <pose>-0.02 0 0.155 0 0 0</pose>
        <geometry>
          <box><size>0.64 0.44 .31</size></box>
        </geometry>
      </collision>
      
    </link>

    <joint name="battery_dx_joint" type="fixed">
      <parent>base_link</parent>
      <child>battery_dx_link</child>
      <pose relative_to="base_link">-0.13 -1.029 0.448 0 0 0</pose>
    </joint>

    <link name="battery_sx_link">
      <pose relative_to="battery_sx_joint" />

        <inertial>
        <pose>-0.02 0 0.155 0 0 0</pose>
        <mass>23.5</mass>
        <inertia>
          <ixx>0.5015291666666667</ixx>
          <iyy>0.8931958333333333</iyy>
          <izz>1.0183333333333333</izz>
          <ixy>0</ixy>
          <ixz>0</ixz>
          <iyz>0</iyz>
        </inertia>
      </inertial>

      <visual name="battery_visual">
        <geometry>
          <mesh> 
            <uri>meshes/battery.dae</uri>
          </mesh>
        </geometry>
      </visual>

      <collision name="battery_collision">
        <pose>-0.02 0 0.155 0 0 0</pose>
        <geometry>
          <box><size>0.64 0.44 0.31</size></box>
        </geometry>
      </collision>
      
    </link>

    <joint name="battery_sx_joint" type="fixed">
      <parent>base_link</parent>
      <child>battery_sx_link</child>
      <pose relative_to="base_link">-0.13 1.029 0.448 0 0 0</pose>
    </joint>

    <link name="cpu_cases_link">
      <pose relative_to="cpu_cases_joint" />

      <inertial>
        <mass>20</mass>
        <inertia>
          <ixx>1.51633333333333</ixx>
          <iyy>1.93633333333333</iyy>
          <izz>2.71633333333333</izz>
          <ixy>0</ixy>
          <ixz>0</ixz>
          <iyz>0</iyz>
        </inertia>
      </inertial>

      <visual name="cpu_cases_visual">
        <geometry>
          <mesh> 
            <uri>meshes/cpu_cases.dae</uri>
          </mesh>
        </geometry>
      </visual>
      <collision name="cpu_case_1_collision">
        <pose>0.1 0 0.235 0 0 0</pose>
        <geometry>
          <box><size>0.595 0.83 0.47</size></box>
        </geometry>
      </collision>
      <collision name="cpu_case_2_collision">
        <pose>-0.387 0 0.14 0 0 0</pose>
        <geometry>
          <box><size>0.375 0.64 0.28</size></box>
        </geometry>
      </collision>

      <sensor name="imu_sensor" type="imu">
        <update_rate>100</update_rate>
        <visualize>true</visualize>
        <topic>demo/imu</topic>
        <gz_frame_id>cpu_cases_link</gz_frame_id>
        <imu>
          <angular_velocity>
            <x>
              <noise type="gaussian">
                <mean>0</mean>
                <stddev>0.009</stddev>
                <bias_mean>0.00075</bias_mean>
                <bias_stddev>0.005</bias_stddev>
                <dynamic_bias_stddev>0.00002</dynamic_bias_stddev>
                <dynamic_bias_correlation_time>400.0</dynamic_bias_correlation_time>
                <precision>0.00025</precision>
              </noise>
            </x>
            <y>
              <noise type="gaussian">
                <mean>0</mean>
                <stddev>0.009</stddev>
                <bias_mean>0.00075</bias_mean>
                <bias_stddev>0.005</bias_stddev>
                <dynamic_bias_stddev>0.00002</dynamic_bias_stddev>
                <dynamic_bias_correlation_time>400.0</dynamic_bias_correlation_time>
                <precision>0.00025</precision>
              </noise>
            </y>
            <z>
              <noise type="gaussian">
                <mean>0</mean>
                <stddev>0.009</stddev>
                <bias_mean>0.00075</bias_mean>
                <bias_stddev>0.005</bias_stddev>
                <dynamic_bias_stddev>0.00002</dynamic_bias_stddev>
                <dynamic_bias_correlation_time>400.0</dynamic_bias_correlation_time>
                <precision>0.00025</precision>
              </noise>
            </z>
          </angular_velocity>
          <linear_acceleration>
            <x>
              <noise type="gaussian">
                <mean>0</mean>
                <stddev>0.021</stddev>
                <bias_mean>0.05</bias_mean>
                <bias_stddev>0.0075</bias_stddev>
                <dynamic_bias_stddev>0.000375</dynamic_bias_stddev>
                <dynamic_bias_correlation_time>175.0</dynamic_bias_correlation_time>
                <precision>0.005</precision>
              </noise>
            </x>
              <y>
                <noise type="gaussian">
                  <mean>0</mean>
                  <stddev>0.021</stddev>
                  <bias_mean>0.05</bias_mean>
                  <bias_stddev>0.0075</bias_stddev>
                  <dynamic_bias_stddev>0.000375</dynamic_bias_stddev>
                  <dynamic_bias_correlation_time>175.0</dynamic_bias_correlation_time>
                  <precision>0.005</precision>
                </noise>
              </y>
            <z>
              <noise type="gaussian">
                <mean>0</mean>
                <stddev>0.021</stddev>
                <bias_mean>0.05</bias_mean>
                <bias_stddev>0.0075</bias_stddev>
                <dynamic_bias_stddev>0.000375</dynamic_bias_stddev>
                <dynamic_bias_correlation_time>175.0</dynamic_bias_correlation_time>
                <precision>0.005</precision>
              </noise>
            </z>
          </linear_acceleration>
        </imu>
      </sensor>
    </link>

    <joint name="cpu_cases_joint" type="fixed">
      <parent>base_link</parent>
      <child>cpu_cases_link</child>
      <pose relative_to="base_link">0.073 0 1.3 0 0 0</pose>
    </joint>

    <!--TRIPOD-->

    <link name="tripod_legs_link">
      <pose relative_to="tripod_legs_joint" />

      <inertial>
        <pose>0 0 0.11 0 0 0</pose> 
        <mass>0.35</mass> 
        <inertia>
          <ixx>0.0008</ixx> 
          <iyy>0.0008</iyy>
          <izz>0.0005</izz>
        </inertia>
      </inertial>
      
      <visual name="tripod_legs_visual">
        <geometry>
          <mesh>
            <uri>meshes/legs.dae</uri>
          </mesh>
        </geometry>
        <material>
          <ambient>0.15 0.15 0.15 1</ambient>
          <diffuse>0.25 0.25 0.25 1</diffuse>
          <specular>0.35 0.35 0.35 1</specular>
        </material>
      </visual>

      <collision name="tripod_legs_collision">
        <pose>0 0 0.11 0 0 0</pose>
        <geometry>
          <cylinder>
            <length>0.218</length>
            <radius>0.1</radius>
          </cylinder>
        </geometry>
        <surface>
          <friction>
            <ode>
              <mu>0.7</mu>
            </ode>
          </friction>
        </surface>
      </collision>
      
    </link>

    <!-- GIUNZIONE FISSA CON POSIZIONAMENTO PRECISO -->
    <joint name="tripod_legs_joint" type="fixed">
      <parent>base_link</parent>
      <child>tripod_legs_link</child>
      <pose relative_to="base_link">0.77 0 1.29 0 0 0</pose>
    </joint>

    <link name="tripod_ring_link">
      <pose relative_to="tripod_ring_joint" />
      <inertial>
        <pose>0 0 0.005 0 0 0</pose> 
        <mass>0.15</mass>  <!-- Aggiornata per raggio 6cm -->
        <inertia>
          <ixx>0.00015</ixx>  <!-- Inerzia ridotta -->
          <iyy>0.00015</iyy>
          <izz>0.0001</izz>
        </inertia>
        <pose>0 0 0.01 0 0 0</pose>  <!-- Centro di massa piÃ¹ basso -->
      </inertial>
      
      <visual name="ring_visual">
        <geometry>
          <mesh>
            <uri>meshes/ring.dae</uri>
          </mesh>
        </geometry>
        <material>
          <ambient>0.35 0.35 0.38 1</ambient>
          <diffuse>0.65 0.65 0.70 1</diffuse>
          <specular>0.95 0.95 0.98 1</specular>
        </material>
      </visual>

      <collision name="tripod_ring_collision">
        <pose>0 0 0.005 0 0 0</pose> 
        <geometry>
          <cylinder>
            <length>0.01</length>
            <radius>0.068</radius>
          </cylinder>
        </geometry>
      </collision>
    </link>

    <joint name="tripod_ring_joint" type="fixed">
      <parent>tripod_legs_link</parent>
      <child>tripod_ring_link</child>
      <pose relative_to="tripod_legs_link">0 0 0.218 0 0 0</pose>
    </joint>

    <!-- SENSORS -->

    <!--LIDAR & GPS -->
    <link name="lidar_link">
      <pose relative_to="lidar_joint" />

      <inertial>
        <pose>0 0 0.036 0 0 0</pose>
        <mass>0.83</mass>
        <inertia>
          <ixx>0.001</ixx>
          <ixy>0</ixy>
          <ixz>0</ixz>
          <iyy>0.001</iyy>
          <iyz>0</iyz>
          <izz>0.001</izz>
        </inertia>
      </inertial>
      
      <visual name="lidar_visual">
        <geometry>
          <mesh>
            <uri>meshes/lidar_3d_v1.dae</uri>
          </mesh>
        </geometry>
      </visual>

      <collision name="lidar_collision">
        <pose>0 0 0.036 0 0 0</pose>
        <geometry>
          <cylinder>
            <length>0.072</length>
            <radius>0.0515</radius>
          </cylinder>
        </geometry>
      </collision>

      <sensor name="gpu_lidar" type="gpu_lidar">

        <pose>0 0 0.036 0 0.139626 0</pose>
        <update_rate>15</update_rate>
        <topic>scan</topic>
        <gz_frame_id>lidar_link</gz_frame_id>

        <ray>
          <scan>
            <horizontal>
              <samples>640</samples>
              <resolution>1</resolution>
              <min_angle>-1.396263</min_angle>
              <max_angle>1.396263</max_angle>
            </horizontal>
            <vertical>
              <samples>16</samples>
              <resolution>1</resolution>
              <min_angle>-0.26179</min_angle>
              <max_angle>0.26179</max_angle>
            </vertical>
          </scan>
          <range>
            <min>0.1</min>
            <max>30.0</max>
            <resolution>0.01</resolution>
          </range>
          <noise>
            <type>gaussian</type>
            <mean>0.0</mean>
            <stddev>0.01</stddev>
          </noise>
        </ray>
        <always_on>1</always_on>
        <visualize>true</visualize>
      </sensor>

      <sensor name="gps_sensor" type="gps">
        <always_on>true</always_on>
        <update_rate>1.0</update_rate>
        <visualize>true</visualize>
        <topic>fix</topic>
        <gz_frame_id>lidar_link</gz_frame_id>
        <gps>
          <position_sensing>
            <horizontal>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>0.000001</stddev>
              </noise>
            </horizontal>
            <vertical>
              <noise type="gaussian">
                <mean>0.0</mean>
                <stddev>0.000001</stddev>
              </noise>
            </vertical>
          </position_sensing>
        </gps>
      </sensor>

    </link>

    <joint name="lidar_joint" type="fixed">
      <parent>tripod_ring_link</parent>
      <child>lidar_link</child>
      <pose relative_to="tripod_ring_link">0 0 0.01 0 0 0</pose>
    </joint>
   
    <plugin
      filename="gz-sim-thruster-system"
      name="gz::sim::systems::Thruster">
      <joint_name>left_engine_propeller_joint</joint_name>
      <thrust_coefficient>0.004422</thrust_coefficient>
      <fluid_density>1000</fluid_density>
      <propeller_diameter>0.2</propeller_diameter>
      <velocity_control>true</velocity_control>
    </plugin>

    <plugin
      filename="gz-sim-joint-position-controller-system"
      name="gz::sim::systems::JointPositionController">
      <joint_name>left_chassis_engine_joint</joint_name>
      <use_velocity_commands>true</use_velocity_commands>
      <topic>/wamv/left/thruster/joint/cmd_pos</topic>
    </plugin>

    <!--  enable the right thruster -->
    <plugin
      filename="gz-sim-thruster-system"
      name="gz::sim::systems::Thruster">
      <joint_name>right_engine_propeller_joint</joint_name>
      <thrust_coefficient>0.004422</thrust_coefficient>
      <fluid_density>1000</fluid_density>
      <propeller_diameter>0.2</propeller_diameter>
      <velocity_control>true</velocity_control>
    </plugin>

    <plugin
      filename="gz-sim-joint-position-controller-system"
      name="gz::sim::systems::JointPositionController">
      <joint_name>right_chassis_engine_joint</joint_name>
      <use_velocity_commands>true</use_velocity_commands>
      <topic>/wamv/right/thruster/joint/cmd_pos</topic>
    </plugin>

    <!--  buoyancy on the left hull -->
    <plugin
      filename="libSurface.so"
      name="wamv_gazebo::Surface">
      <link_name>base_footprint</link_name>
      <hull_length>4.9</hull_length>
      <hull_radius>0.213</hull_radius>
      <fluid_level>0</fluid_level>
      <points>
        <point>0.6 1.03 0</point>
        <point>-1.4 1.03 0</point>
      </points>
      <wavefield>
        <topic>/wamv_gazebo/wavefield/parameters</topic>
      </wavefield>
    </plugin>

    <!-- buoyancy on the right hull -->
    <plugin
      filename="libSurface.so"
      name="wamv_gazebo::Surface">
      <link_name>base_footprint</link_name>
      <hull_length>4.9</hull_length>
      <hull_radius>0.213</hull_radius>
      <fluid_level>0.0</fluid_level>
      <points>
        <point>0.6 -1.03 0</point>
        <point>-1.4 -1.03 0</point>
      </points>
      <wavefield>
        <topic>/wamv_gazebo/wavefield/parameters</topic>
      </wavefield>
    </plugin>

    <!-- HYDRODYNAMICS -->
    <plugin
      filename="gz-sim-hydrodynamics-system"
      name="gz::sim::systems::Hydrodynamics">
      <link_name>base_footprint</link_name>
      <xDotU>0.0</xDotU>
      <yDotV>0.0</yDotV>
      <nDotR>0.0</nDotR>
      <xU>-51.3</xU>
      <xAbsU>-72.4</xAbsU>
      <yV>-40.0</yV>
      <yAbsV>0.0</yAbsV>
      <zW>-500.0</zW>
      <kP>-50.0</kP>
      <mQ>-50.0</mQ>
      <nR>-400.0</nR>
      <nAbsR>0.0</nAbsR>
    </plugin> 
    
    <plugin
      filename="gz-sim-odometry-publisher-system"
      name="gz::sim::systems::OdometryPublisher">
      
      <odom_topic>/odom</odom_topic>
      <odom_frame>odom</odom_frame>
      <robot_base_frame>base_footprint</robot_base_frame>
      <dimension>3</dimension>
      <publish_tf>false</publish_tf> 
      <odom_publish_frequency>20.0</odom_publish_frequency>
  </plugin>


  </model>
</sdf>
